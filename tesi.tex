\documentclass[]{article}

%opening
\title{Malicious context and workaround analysis of decentralized VPN:\\the case of Mysterium Network}
\author{Jacopo Federici}


\usepackage{imakeidx}
\usepackage{setspace}
\makeindex

\begin{document}
	\setstretch{1.0}
	\maketitle	
	\clearpage
	
	\tableofcontents{}

	\subsection{Note}
	parlare di:
	\begin{itemize}
		\item docker (cosa è, comandi base per fare cosa)
		\item robe di networking per dev mode del progetto:
		\begin{itemize}
			\item https://www.digitalocean.com/community/tutorials/a-deep-dive-into-iptables-and-netfilter-architecture
			\item http://www.naturalborncoder.com/virtualization/2014/10/17/understanding-tun-tap-interfaces/
			\item http://linux-training.be/networking/ch14.html
		\end{itemize}
	\end{itemize}

	\section{parte introduttiva}
	
	The need for privacy is becoming more important day after day. The heavily digitalization of many aspects of our life implicitly exposes  us and our data. The basic actions performed on a computer which involve an internet connection, as a majority of them, are becoming unsafe.\\
	In the last years we have seen security solutions integration in popular applications, such as browsers or mobile apps, following the increasing of security attacks. For instance, in 2017 the popular Chrome browser announced it would mark as non-secure any website using the HTTP protocol instead of HTTPS. This move was to encourage website to use SSL/TLS certificates and make secure the communication between client and server. It's interesting to discover the first HTTPS version has been made by Netscape Navigator browser, a pioneer browser at the beginning of internet, around 1990 and the official RFC publication has been released in May 2000 \ref{https://tools.ietf.org/html/rfc2818}. ((Why this solution has been largely used only fifteen years later?))\\	
	Similar scenario for the VPN: abbreviation for virtual private network, it's a technical solution to extend a \textit{private} network across a \textit{public} network. It is created by establishing a virtual point-to-point connection through the use of dedicated circuits or with tunneling protocols over existing networks. Many of the VPN implementations encrypt the traffic between the two points. A first VPN specification proposal can be dated around 2000 \ref{https://tools.ietf.org/html/rfc2764}. In the last years, this feature is making the use of VPN very large because it solves privacy problems the VPN was not intentionally design for, such as crossing a censored network rather than use services available only in certain countries.\\
	Currently, there are many commercial solutions that allow users to have a private connection between their computer and the company servers across the world. In this way the user can have access to the internet resources from the geoposition he prefers, skipping firewalls and other censure methods applied by some countries, for instance China with the Great Fire Wall.\\
	There are many security concerns about those commercial solutions, such as the ability of the company to keep logs, inspect the traffic or sell statistic data obtained by the users.\\
	Starting from these problems, some open source projects were, lately, born. Their goal is to revolution the idea of VPN and its uses, building a rich network of peers where two nodes can connect to each other through a VPN. The project provides a platform including all the components needed to have a efficient, fast and easy to use system, from the discovering to the payment.\\
	
	In this research document we analyzed the most developed project, Mysterium by Mysterium Network, as case of study. As we write, Mysterium offers a working network composed by hundreds of nodes around the world and it's the best project where to investigate malicious contexts and design vulnerabilities owns by the decentralized architecture, more than the Mysterium project itself.\\We even discover how secondary aspects are pivotal to guide attacks to the system.\\
	The second step focuses on the solutions can be implemented in the system to patch those critical aspects. A comparing between different solutions is provided with an eye on the practical prospective.\\
		
	
	\subsection{Abstract}
	\subsection{Work structure}
	\subsection{Outline}
	\subsection{Goal}
	
	
	\section{State of art}
	
	\subsection{The world, now}
	(stato attuale, attacchi etc)
	
	\begin{verbatim}
	https://www.geeksforgeeks.org/need-of-information-security/
	https://www.hackerfactor.com/blog/index.php?/archives/868-Deanonymizing-Tor-Circuits.html
	\end{verbatim}
	
	\subsection{the need of trust and privacy (vpn, blockchain, decentralizzazione, fiducia in sistemi democratici)}
	\begin{verbatim}
	https://www.howtogeek.com/133680/htg-explains-what-is-a-vpn/
	https://www.forbes.com/sites/tjmccue/2019/06/20/why-use-a-vpn/#3f08d7105859
	https://www.investopedia.com/terms/b/blockchain.asp
	https://www.howtogeek.com/350322/what-is-ethereum-and-what-are-smart-contracts/
	
	https://en.wikipedia.org/wiki/Proof_of_work
	https://en.wikipedia.org/wiki/Proof_of_stake
	\end{verbatim}
	
	It is natural that concepts as "consensus" and as "distributed" gain value and it's undoubted the main technology to manage such kind of situation is the blockchain in the Ethereum variant thanks to its contract mechanism.\\
	
	\subsection{just more, we are our trust (come funziona blockchain, perchè in contesti come dvpn serve decentralizzazione e consenso)}
	
	\section{My work, steps}
	\subsection{Decentralized VPNs}
	\subsubsection{Introduction}
		
	concetti introduttivi
	- blockchain in linea di massima\\
	- ethereum in linea di massima e descrizione degli smart contracts\\
	- proof of work, proof of stake\\
	- reputazione in una net (Eigentrust)\\
	- - cercare applicazione pratica di Eigentrust\\
	- descrizione di BFT\\
	
	The main open source projects are Mysterium Network, Privatix, Substratum and Sentinel. We explored all of them and we discovered the four different approaches they implement to reach the goal: building a distributed network based on blockchain with a discovering system, a crypto coin payment method, a mobile and desktop application. We can safely say the most advanced project is Mysterium Network, in terms of development and design. Furthermore it's 100\% open source, that for this kind of project is an important quality which conditions the users adoption and market diffusion.\\
	Therefore, we decide to use Mysterium Network as test case to implement our proof of concepts.\\
	
	\subsubsection{The business idea}
	As a business project, which aim to earn money, every project has a specific business plan but the common idea is the same: provide a system network where users can join as a service provider, selling their internet bandwidth, or as a service consumer, buying other's internet bandwidth. Each couple of entities, consumer and provider, agree on a transaction paid in crypto coin in the face of the used service. This transaction is ruled by an Ethereum smart contract signed by both of the sides. To close the transaction a fee to the system must be paid. This fees is not the Ethereum smart contract fee, called gas, but the Mysterium source of earnings. For this reason Mysterium and other projects realized an internal market with a private coin (for Mysterium is called MYST) used to buy and sell internet bandwidth inside the network. It's possible to convert MYST to ETH like normal crypto coin exchange.\\
	The type of market is called two-sides market where supply and demand respectively grow on the other side growth. It's the typical market for digital goods and usually only one actor tends to dominate more than half of the market.
		
	\subsubsection{Mysterium Network}
	
	\textbf{Architecture}
	Mysterium Network in an open source project. The main goal is to realize a decentralized infrastructure made up of layered VPN protocols, blockchain and smart contracts.\\
	There are four core components composing the infrastructure:
	\begin{enumerate}
		\item \textbf{Ethereum Blockchain} allows to run decentralized code with smart contracts, enabling reliable
		services and payment handling.
		\item \textbf{Identity service and database of registered identities} ensures the proper identity
		acknowledgement between client and service provider.
		\item \textbf{Discovery service and database of available services} provide means to announce
		VPN services availability and pick the most suitable VPN service.
		\item \textbf{Payment service and database of balances} allows secure promise-based
		micropayments for services.
	\end{enumerate}
	
	Mysterium collects all the agents service proposals and presents them to the clients, register the client's intention to pay for the agent's service choosed by the user and create the VPN connection between the two points.\\
	It is saved in the blockchain the outcome of each transaction. In this manner it's possible to rebuild the transaction history for any specific user, be it a consumer or a producer.
	
	\textbf{Substratum}
	\textbf{caratteristiche comuni}
	\textbf{BTF}
	\textbf{Attacchi di tipo...}
	
	\subsection{Basic sniffing to catch content (Wireshark, tcpdump)}
	\subsection{Craftberry, a demo tool}
			useful tips
			\begin{verbatim}
				http://unixwiz.net/techtips/gnu-c-attributes.html
				https://gcc.gnu.org/onlinedocs/gcc-4.0.2/gcc/Type-Attributes.html
				https://groups.google.com/forum/#!msg/pcapplusplus-support/e7rN93LfTSg/MFnVEKCNCAAJ
				https://byt3bl33d3r.github.io/using-nfqueue-with-python-the-right-way.html
			\end{verbatim}
			
			\subsubsection{liv 2: arp, vlan tagging}
			\subsubsection{liv 3: ip, icmp}
			\subsubsection{liv 4: tcp/udp}
			\subsubsection{side attacks}
				- auditin/collezione dei dati sniffati, inviati ad un server esterno per collezionamento, statistiche, vendita a terzi.
				- trojan all'interno di craftberry, per botnet. (approfondire aspetto che se il sw di attacco diventa popolare, può essere lui stesso veicolo di malware, quindi attacco l' attaccante)
			
			\begin{itemize}
				\item copia x volte dei pacchetti (TCP/UDP)
				\item gonfiamento dei pacchetti nei campi che poi verranno corretti dai check (TCP/UDP)
				\item modifica del payload se in chiaro (TCP/UDP)
				\item azione positiva sul payload (UDP), ad esempio cifratura chacha20
			\end{itemize}
		 	\subsubsection{liv 5+: http/imap/dns/ntp/etc}
				analisi e modifica dei contenuti a livello del singolo protocollo (ad esempio sostituzione di tutte le immagini con una immagine di default)
			
	\subsection{Design solutions for malicious context}
		\subsubsection{comparing}
		invia la richiesta a due nodi e le confronta (essenziale possibilità di connessione a due nodi in contemporanea: due o più container docker mappati su porte diverse con uno script che invia la richiesta a più container e confronta le risposte)
		\subsubsection{comparing hashes}
		come precedente ma con la gestione degli hash invece che di tutto il dato
	\section{Design integration with reputation systems}
	
	\subsection{something here}
	
		
\section{Conclusions}
	\subsection{Tests}
	\subsection{Future development}
	\subsection{Considerations}

	\pagebreak

	\textbf{problemi individuati}
	\begin{enumerate}
		\item valutazione della reputazione dell'agent da parte del client
		\item valutazione della reputazione dell'agent da parte della Net
	\end{enumerate}
	
	\textbf{soluzioni proposta}
	\textbf{Proposte per la valutazione della reputazione dell'agent da parte del client}
	
	Le seguenti proposte sono metodi di verifica del corretto comportamento ed hanno come scopo finale la valutazione della reputazione degli agent
	\begin{itemize}
		\item Dati civetta: modifiche al client che con scadenze richiede una o più risorse dal valore noto e verifica che siano integre. Le scadenze possono essere regolari/random/all’inizio frequenti/dipendenti dalla reputazione dell’agent. È necessario avere delle risorse distribuite e disponibili: potrebbero essere i nodi stessi della rete (altri agent).
		\item Dati duplicati: modifiche al client che implementa la possibilità di connessione con più agent. Dopo la richiesta il client compara i dati ottenuti dalle due fonti
		\begin{itemize}
			\item Hash *: (soluzione aggiuntiva) I nodi sono generalmente in posizioni migliori dei client in termini di velocità. L’idea è quella di far generare un hash dei dati che il client richiede ad un altro nodo fuori dal servizio primario, così da comparare gli hash e non tutto il dato.
			Inoltre, se la richiesta la faccio a molti più nodi posso intrinsicamente verificare quali modificano i dati nel network.
		\end{itemize}
		\item Applicazione di modelli di reputazione (Eigentrust): attualmente non studiato
	\end{itemize}
	
	\pagebreak
	
	\input{proof_of_work_VPN.tex}

\end{document}